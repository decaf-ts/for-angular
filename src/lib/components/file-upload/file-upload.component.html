<div
  class="decaf-file-component"
  #component
>
  <input
    id="dcf-file-input"
    type="file"
    placeholder="Select files"
    [attr.accept]="accept"
    [attr.multiple]="multiple ? true : null"
    (change)="handleSelection($event)"
    [multiple]="multiple"
    hidden
    [attr.webkitdirectory]="enableDirectoryMode ? true : null"
  />

  <ngx-decaf-card
    [className]="className"
    [body]="'blank'"
  >
    @if (['create', 'update'].includes(operation)) {
      <div>
        <div
          [class]="
            'dcf-drop-area ' +
            ' dcf-' +
            size +
            ' dcf-flex dcf-flex-' +
            position +
            ' dcf-text-' +
            position
          "
          [class.dcf-dragging]="dragging"
          [class.dcf-has-files]="files.length"
          (drop)="!files?.length ? handleDrop($event) : (dragging = false)"
          (dragover)="
            !files?.length ? handleDragOver($event) : (dragging = false)
          "
          (dragleave)="
            !files?.length ? handleDragLeave($event) : (dragging = false)
          "
        >
          <div>
            @if (!previewFile) {
              @if (showIcon) {
                <ngx-decaf-icon
                  name="cloud-upload-outline"
                  size="large"
                />
              }
              <p class="dcf-drag-description">
                {{
                  label
                    ? (label | translate)
                    : (locale + '.drag_file' | translate)
                }}
              </p>
              <ion-button
                class="dcf-button-select"
                (click)="handleClickToSelect()"
                size="small"
              >
                {{
                  buttonLabel
                    ? (buttonLabel | translate)
                    : (locale +
                        (enableDirectoryMode
                          ? '.buttons.select_directory'
                          : '.buttons.select') | translate)
                }}
              </ion-button>
              <div #container>
                <span
                  class="dcf-error"
                  [innerHTML]="getErrors(container)"
                ></span>
              </div>
            } @else {
              @if (!directoryMode && !multiple) {
                <div
                  class="dcf-preview dcf-grid dcf-grid-match dcf-grid-collapse"
                >
                  <div
                    class="dcf-width-1-4@m dcf-width-1-3@s dcf-flex dcf-flex-center dcf-flex-middle"
                  >
                    <div class="dcf-preview-image">
                      <ion-img
                        [src]="previewFile"
                        [title]="locale + '.preview' | translate"
                        [alt]="locale + '.preview' | translate"
                      />
                      <div class="dcf-overlay">
                        <ion-button
                          (click)="preview(previewFile)"
                          fill="clear"
                          color="light"
                          size="small"
                        >
                          {{ locale + '.buttons.preview' | translate }}
                        </ion-button>
                      </div>
                    </div>
                  </div>
                  <div
                    class="description dcf-flex dcf-flex-middle dcf-width-expand@s"
                  >
                    <div>
                      <p class="dcf-title">
                        {{ locale + '.preview' | translate }}
                      </p>
                      <p class="subtitle">{{ files[0].name }}</p>
                      <ion-button
                        (click)="handleClear()"
                        fill="clear"
                        color="danger"
                        size="small"
                      >
                        {{ locale + '.buttons.clear' | translate }}
                      </ion-button>
                    </div>
                  </div>
                </div>
              } @else {
                <div class="dcf-margin-bottom">
                  {{ locale + ".selection" | translate: { "0": files.length > 10 ? files.length : `0${files.length}` } }}
                  @if (errors.length > 0) {
                    <br />
                    <span class="dcf-error-message">
                      {{ locale + ".selection_error" | translate: { "0": errors.length > 10 ? errors.length : `0${errors.length}` } }}
                    </span>
                  }
                </div>
                <div class="dcf-preview-list-container">
                  <ion-list class="dcf-preview-list">
                    @for (file of errors; track $index) {
                      <ion-item
                        lines="full"
                        class="dcf-error-item"
                      >
                        <ion-label slot="start">{{ file.name }}</ion-label>
                        <div
                          class="dcf-error-message"
                          slot="end"
                        >
                          {{
                            locale + '.errors.' + file.error
                              | translate
                                : {
                                    '0':
                                      file.error === 'max_size'
                                        ? maxFileSize / 1024 / 1024
                                        : file.name.split('.'),
                                  }
                          }}
                        </div>
                        <ion-note slot="end">
                          {{ file.size / 1024 / 1024 | number: '1.1-1' }} MB
                        </ion-note>
                      </ion-item>
                    }

                    @for (file of files; track $index) {
                      <ion-item lines="full">
                        <ion-label slot="start">{{ file.name }}</ion-label>
                        <ion-note slot="end">
                          {{ file.size / 1024 / 1024 | number: '1.1-1' }} MB
                        </ion-note>
                        <div
                          class="dcf-flex dcf-flex-middle"
                          slot="end"
                        >
                          <ngx-decaf-icon
                            [button]="true"
                            [slot]="'icon-only'"
                            (click)="preview(file?.source || file, file.type)"
                            [name]="
                              file.type.includes('image')
                                ? 'image-outline'
                                : 'document-text-outline'
                            "
                          />
                          <ngx-decaf-icon
                            [button]="true"
                            [slot]="'icon-only'"
                            [name]="'trash-outline'"
                            (click)="removeFile($index)"
                            [color]="'danger'"
                            [size]="'small'"
                          />
                        </div>
                      </ion-item>
                    }
                  </ion-list>
                </div>
              }
            }
          </div>
        </div>
      </div>
    } @else {
      <div [class]="files?.length > 1 ? 'dcf-preview-list-container' : ''">
        <ion-label [class]="operation ?? 'read'">
          {{ label | translate }}
        </ion-label>
        @if (!files?.length) {
          <div class="dcf-padding-xsmall">
            <ion-text>{{ locale + '.empty' | translate }}</ion-text>
          </div>
        } @else {
          @if (files?.length === 1 && isImageFile(files[0])) {
            <div
              class="dcf-preview dcf-grid dcf-grid-match dcf-grid-collapse read"
            >
              <div
                class="dcf-width-1-4@m dcf-width-1-3@s dcf-flex dcf-flex-center dcf-flex-middle"
              >
                <div class="dcf-preview-image">
                  <ion-img
                    [src]="previewFile"
                    [title]="locale + '.preview' | translate"
                    [alt]="locale + '.preview' | translate"
                  />
                  <div class="dcf-overlay">
                    <ion-button
                      (click)="preview(previewFile)"
                      fill="clear"
                      color="light"
                      size="small"
                    >
                      {{ locale + '.buttons.preview' | translate }}
                    </ion-button>
                  </div>
                </div>
              </div>
              <div
                class="description dcf-flex dcf-flex-middle dcf-width-expand@s"
              >
                <div>
                  <p class="dcf-title">{{ locale + '.preview' | translate }}</p>
                  <p class="subtitle">{{ files[0].name }}</p>
                </div>
              </div>
            </div>
          } @else {
            <ion-list class="dcf-preview-list">
              @for (file of files; track $index) {
                <ion-item lines="full">
                  @if (file?.name) {
                    <ion-label slot="start">{{ file.name }}</ion-label>
                  }
                  <div
                    class="dcf-flex dcf-flex-middle"
                    slot="end"
                  >
                    <ngx-decaf-icon
                      [button]="true"
                      [slot]="'icon-only'"
                      (click)="preview(file.source, file.type)"
                      [name]="
                        file.type.includes('image')
                          ? 'image-outline'
                          : 'document-text-outline'
                      "
                    />
                  </div>
                </ion-item>
              }
            </ion-list>
          }
        }
      </div>
    }
  </ngx-decaf-card>
</div>
